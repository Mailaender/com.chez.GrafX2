app-id: com.chez.GrafX2
runtime: org.freedesktop.Sdk
runtime-version: '18.08'
sdk: org.freedesktop.Sdk
command: grafx2-sdl
rename-desktop-file: grafx2.desktop
rename-appdata-file: grafx2.appdata.xml
rename-icon: grafx2
finish-args:
- --socket=wayland
- --socket=x11
- --share=ipc
- --device=dri
- --filesystem=home # required since it doesn't use portals
modules:
- shared-modules/glu/glu-9.0.0.json

- shared-modules/SDL/SDL-1.2.15.json

- shared-modules/SDL/SDL_image-1.2.12.json

- shared-modules/SDL/SDL_ttf-2.0.11.json

- shared-modules/lua5.3/lua-5.3.2.json

- name: grafx2
  no-autogen: true
  subdir: src
  sources:
  - type: archive
    url: https://gitlab.com/GrafX2/grafX2/-/archive/v2.6/grafX2-v2.6.tar.bz2
    sha256: a672d381df55a8180febb005cbafbbfc87b8f7eeec9743acdc33214cc59a2e00
  - type: file
    url: https://sourceforge.net/projects/recoil/files/recoil/4.3.1/recoil-4.3.1.tar.gz
    sha256: 8f64fd21bafa180e6cbac5853ef65453f080385b3c53600af8360e938668e574
    dest: 3rdparty/archives # taken from https://git.archlinux.org/svntogit/community.git/tree/trunk/PKGBUILD?h=packages/grafx2
  build-commands:
  - sed -i 's|/usr/local|/app|' ./Makefile
  - desktop-file-edit --set-key Exec --set-value 'grafx2-sdl %f' ../misc/unix/grafx2.desktop
